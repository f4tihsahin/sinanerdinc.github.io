---
layout: post
published: false
title: Jq Paketi Kullanımı
subtitle: Terminal üzerinden JSON dosyalarınızı işleyebileceğiniz harika bir araç.
permalink: /jq-paketi-kullanimi
image: /img/2018/jq.png
share-img: /img/2018/jq.png
tags: [linux, terminal]
date: 2018-02-12
categories:
    - "linux"
---

Eğer JSON dosyaları ile uğraşıyorsanız, terminalden Jq eklentisi ise işlemlerinizi hızlandırabilirsiniz. Bir önceki yazımda Httpie paketini anlatmış ve Yazılımcı Curl'ü demiştim. Bu Jq paketini de httpie paket ile beraber kullanıcam. O yüzden ilk önce dilerseniz httpie paketini anlattığım yazımı inceleyin.

# Kurulum

```
sudo apt-get install jq
```
komutu ile bilgisayarınıza kurabilirsiniz.

# Kullanımı
Bu eklentiyi jq komutu ile kullanacağız. Genel olarak kullanım amacım bir yerdeki json dosyasını parse etmek üzerine olacak.

```
http httpbin.org/get
```
Bu komut ile httpbin.org/get adresine bir istek atalım ve dönen cevabı inceleyelim.

```
{
    "args": {},
    "headers": {
        "Accept": "*/*",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "close",
        "Host": "httpbin.org",
        "User-Agent": "HTTPie/0.9.2"
    },
    "origin": "73.192.158.136",
    "url": "http://httpbin.org/get"
}
```
Dönen cevap içinden sadece origin veya headers yazan alanı çekmek istiyorum.

Eğer origin alanını çekmek istersem

```
http httpbin.org/get | jq .origin
```
komutu ile gelen isteği jq ya atıyorum ve .origin ile sadece belirttiğim alanı getir diyorum. Aynı şekilde

```
http httpbin.org/get | jq .headers
```
ile sadece headers alanını çekebilirim.

Peki ikisini tek bir satırda yazarak çekebilir miyim?

```
http httpbin.org/get | jq '{headers,origin}'
```
Böyle de kullanarak ikisini tek seferde çekebilirsiniz. Tek tırnak içindeki alanlar Jq filtreleridir, yavaş yavaş ısınmaya başladık bu filtrelere.

Şuan küçük bir json ile çalışıyoruz, ne gerek var onu çekmeye diyebilirsiniz. Birazdan çok daha büyük json dosyaları ile çalışacağız.

Şimdi de kullanıcı ve şifre bilgilerini post eden bir HTTP isteği atalım.

```
http POST https://httpbin.org/post kullanici=sinan sifre=qwerty
```
Bu komut bana şunu dönecek.

```
{
    "args": {},
    "data": "{\"kullanici\": \"sinan\", \"sifre\": \"qwerty\"}",
    "files": {},
    "form": {},
    "headers": {
        "Accept": "application/json",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "close",
        "Content-Length": "41",
        "Content-Type": "application/json",
        "Host": "httpbin.org",
        "User-Agent": "HTTPie/0.9.2"
    },
    "json": {
        "kullanici": "sinan",
        "sifre": "qwerty"
    },
    "origin": "78.190.128.196",
    "url": "https://httpbin.org/post"
}
```
Ben de dönen data içinde json içindeki sifre değerine ulaşmak istiyorum, o zaman hemen bunu jq ya aktarıp alalım.

```
http POST https://httpbin.org/post kullanici=sinan sifre=qwerty | jq .json.sifre
```
Bu komut da bana **qwerty** değerini döner.

Şimdi biraz işleri karıştıralım. Mesela bir API üzerinden users endpointine istek attınız ve kullanıcıların json çıktısını aldınız. Bunun için ben örnek json olarak

https://jsonplaceholder.typicode.com/users

datasını kullanacağım. Bu json içinde 10 tane kullanıcının bilgileri var. Bu bilgileri jq ile işleyip almayı deneyelim.

Bu tür datalar dikkat ederseniz tek bir bilgi içermiyor. Yani bir dizi (array) şeklinde birden fazla kullanıcının bilgisini tutuyor. Bu nedenle biz de jq ile işlerken buna dikkat edicez.

```
http https://jsonplaceholder.typicode.com/users | jq '.[] .name'
```
Burda gelen verinin bir array olduğunu .[] ile söyledik ve her bir değeri dön dedik, sonra da name alanlarını bize göster dedik.

```
"Leanne Graham"
"Ervin Howell"
"Clementine Bauch"
"Patricia Lebsack"
"Chelsey Dietrich"
"Mrs. Dennis Schulist"
"Kurtis Weissnat"
"Nicholas Runolfsdottir V"
"Glenna Reichert"
"Clementina DuBuque"
```

şeklinde verdi, peki siz istiyorsunuz ki ben sadece isim ve e-mail değerini alıp yeni bir obje yapayım. Tamam, hallederiz.

```
http https://jsonplaceholder.typicode.com/users | jq '.[] | {isim: .name, mail: .email}'
```

Burda ise yine .[] ile kaynağın bir array olduğunu söyledik ve her birini dön dedik, sonra da  isim ve mail adında bir data oluştur ve içine kaynaktaki .name ve .email alanlarını koy dedik. Bunun çıktısı da

```
{
  "isim": "Leanne Graham",
  "mail": "Sincere@april.biz"
}
{
  "isim": "Ervin Howell",
  "mail": "Shanna@melissa.tv"
}
```

şeklinde oldu. Ben ilk iki hariç kalanını sildim o yüzden 2 tane görüyorsunuz.

Peki sadece 5. kullanıcıyı almak istesem ne yapardım? Bunun indisinin 4 olduğunu biliyorum.

```
http https://jsonplaceholder.typicode.com/users | jq '.[4]'
```
ile indisi 4 olan yani 5. kullanıcıyı çekebildim.

Peki ben ilk 2 kullanıcıyı çekmek isteseydim?

```
http https://jsonplaceholder.typicode.com/users | jq '.[0:2]'
```
Böylede 0 indisinden başla 2'ye kadar (2 dahil değil) getir dedim. 0 ve 1 getirdi, bunlar da ilk 2 kullanıcılar zaten.

Obje içinde hangi anahtarlar var görmek isterseniz

```
http https://jsonplaceholder.typicode.com/users | jq '.[0] | keys'
```
gibi kullanabilirsiniz. Ben burda 0. indisin anahtarlarını görmek istediğimi söyledim.
```
[
  "address",
  "company",
  "email",
  "id",
  "name",
  "phone",
  "username",
  "website"
]
```
şeklinde geri döndü.

Dönen değer içinde email alanı var mı diye kontrol etmek istersek;
```
http https://jsonplaceholder.typicode.com/users | jq '.[0] | has("email")'
```
şeklinde has(email) kullanıyoruz.

Şimdide kaynaktaki adres bilgisi hariç diğerlerini alalım.
```
http https://jsonplaceholder.typicode.com/users | jq '.[0] | del(.address)'
```
Burda ise del(.address) ile, adres verisini silip ekrana bastırdım.

Şimdide biraz koşullu arama yapalım.

```
http https://jsonplaceholder.typicode.com/users | jq '.[] | select(.id <3)'
```
Bunun için select değerini kullanıyoruz ve diyoruz ki .id değeri 3'den küçük olanları getir.

```
http https://jsonplaceholder.typicode.com/users | jq '.[] | select(.email == "Sherwood@rosamond.me")'
```
Şimdi de .email değeri Sherwood@rosamond.me olanı getir dedim.
